# 产品需求文档（PRD）
# 微醺笔记 (Drinking Diary) MVP 版本

## 1. 产品概述

### 1.1 产品定位
微醺笔记是一款专注于个人酒品记录的微信小程序，帮助用户记录每一杯喝过或调制过的酒，建立个人的酒品档案库。

### 1.2 目标用户
- 酒类爱好者：经常品鉴各类酒品，希望记录品鉴体验
- 调酒爱好者：在家调酒，需要记录配方和心得
- 社交饮酒者：在酒吧、餐厅等场所饮酒，想记住喜欢的酒

### 1.3 核心价值
- 解决"不知道喝什么"的问题：通过历史记录快速找到喜欢的酒
- 解决"记不住酒的信息"的问题：完整记录每杯酒的详细信息
- 解决"不知道能做什么"的问题：通过配方笔记查看可调制的酒品

### 1.4 MVP范围
本MVP版本专注于核心记录功能，包括：
- 创建和管理酒品记录
- 首页卡片式浏览（支持按日期纵向浏览，同日记录横向切换）
- 个人酒库统计分析
- 本地数据存储

暂不包括：搜索筛选、云同步、社交分享等功能

### 1.5 视觉设计规范 (Visual Guidelines)
- **色彩体系**：
  - 主色调 (Brand Blue): `#007AFF` (用于按钮、选中状态、强调色)
  - 背景色 (Background): `#F2F2F7` (iOS 风格浅灰背景)
  - 卡片背景 (Card Bg): `#FFFFFF`
  - 文本颜色 (Text): 
    - 主要: `#000000` (90% opacity)
    - 次要: `#3C3C43` (60% opacity)
    - 辅助: `#999999`
  - 评分星星: `#FF9500`
  - 标签背景: `#E5E5EA` (未选中), `#007AFF` (选中)
- **整体视觉氛围**：
  - **动态背景**: 全屏动态背景层，基于当前卡片图片生成高斯模糊 (Blur 3xl, 30% Opacity)，色调平滑过渡 (Duration 1000ms)。
  - **系统底色**: iOS 标准浅灰 #F2F2F7 叠加白色遮罩。
- **圆角与阴影**：
  - 卡片圆角: `16px`
  - 按钮圆角: `12px` 或 Pill shape
  - 卡片阴影: `0 8px 20px rgba(0,0,0,0.08)`
- **字体**：
  - 遵循系统默认字体 (San Francisco / PingFang SC)
  - 标题字重: Semibold / Bold
  - 正文字重: Regular / Medium
- **其他细节**：
  - 隐藏所有滚动条。
  - 点击交互增加缩放 (Scale) 触感反馈。

## 2. 功能架构

### 2.1 功能模块划分
```
微醺笔记
├── 首页模块
│   ├── 顶部导航与问候区
│   ├── 动态背景层
│   ├── 二维卡片流 (纵向日期 + 横向堆叠)
│   ├── 右侧日期指示器
│   └── 空状态引导
├── 个人酒库模块
│   ├── 用户信息展示 (头像/昵称)
│   ├── 核心数据统计 (总杯数/总花费/记录天数)
│   └── 照片墙列表 (3列网格)
├── 记录管理模块
│   ├── 创建记录
│   ├── 编辑记录
│   └── 删除记录
└── 标签系统模块
    ├── 预设标签选择
    ├── 自定义标签输入
    └── 标签状态管理
```

### 2.2 页面结构
```
App
├── 底部导航栏 (TabBar)
│   ├── 首页 (Home)
│   ├── 新建 (+) - 模态弹窗
│   └── 个人 (Profile)
├── 首页 (Home View)
├── 编辑/新建页 (Editor View)
└── 个人页 (Profile View)
```

## 3. 页面详细设计

### 3.1 首页 (Home View)

#### 3.1.1 页面功能
- 展示用户的酒品记录卡片
- 支持二维导航：纵向切换日期，横向切换同一天的不同记录
- 快速预览酒品信息（图、名、分、评、标签）

#### 3.1.2 页面元素

**顶部标题与问候区**
- **位置**：顶部固定。
- **标题栏 (Navigation Bar)**:
  - 高度: 52px。
  - 材质: 高透磨砂玻璃 (Backdrop Blur XL)，底边极细分割线。
  - 内容: 正中央显示 "微醺笔记" (黑色半粗体)。
- **问候语栏 (Greeting Bar)**:
  - 位置: 紧贴导航栏下方，随页面滚动。
  - 左侧: 内容根据时间段变化
    - 6:00-11:00："早安，准备喝点什么？"
    - 11:00-14:00："午后时光，小酌一杯？"
    - 14:00-18:00："下午好，要不要喝点什么？"
    - 18:00-22:00："夜幕降临，来一杯吧"
    - 22:00-6:00："夜深了，来一杯吗？"
  - 右侧: 用户头像 (圆形，带白色边框和投影)。

**动态背景层**
- 位于最底层，全屏覆盖。
- 内容：当前居中卡片的图片经过高斯模糊 (Blur 3xl) 处理。
- 样式：30% 透明度，色调随卡片切换平滑过渡 (1000ms)。

**记录卡片区域 (Card Stream)**
- **布局**：卡片居中，占据屏幕大部分高度 (约 65%)，宽度适配屏幕但留有边距。
- **卡片样式**：纯白背景，大圆角 (16px)，柔和弥散阴影。
- **卡片内容**：
  - **图片区** (上部 60%)：
    - 顶部圆角，Aspect Fill (填充裁剪) 模式。
  - **信息区** (下部 40%)：
    - 标题：酒品名称 (大字号粗体, 水平居中)。
    - 评分：5颗实心橙色星星 (#FF9500)，水平居中。
    - 描述：灰色正文，最多3行，超出省略，文字居中。
    - 底部栏：
      - 左侧：标签胶囊 (Tags)，浅灰底色，支持水平滑动。
      - 右侧：记录时间 (如 "20:30")，灰色小字。
- **堆叠效果 (Card Stack)**：
  - 当某天有多条记录时，卡片呈堆叠状。
  - 后续卡片在背后稍微缩小、向右偏移并带有轻微旋转角度，模拟真实纸张堆叠感。

**日期指示器 (Date Indicator)**
- **位置**：屏幕右侧边缘，垂直居中。
- **选中态**：黑色半胶囊背景，白色文字显示当前日期 (如 "10.24")，带有向左弹出的阴影效果。
- **非选中态**：灰色半胶囊背景，内容收缩为一个小圆点 (半透明黑色)，仅作为位置索引。
- **功能**：随垂直滚动实时更新，指示当前浏览的是哪一天的记录。

**空状态**
- 当没有任何记录时显示。
- 内容：酒杯插图 + 文案"还没有记录，点击下方 + 开始记录第一杯酒"。

**底部导航栏 (Tab Bar)**
- **材质**：全宽悬浮固定在底部，高度 88px，高透磨砂玻璃 (Backdrop Blur XL)。
- **按钮**：
  - **Home (左)**: 房子图标。选中为系统蓝 (#007AFF)，未选中为灰色。图标加大，无文字。
  - **Add (中)**: 悬浮大按钮。直径 56px 圆形，系统蓝背景，白色加号。向上突出一半悬浮，带深色投影。点击弹出全屏 "新建记录" 页。
  - **Profile (右)**: 人像图标。选中为系统蓝，未选中为灰色。图标加大，无文字。

#### 3.1.3 交互逻辑
- **纵向滑动**：以 "日期" 为单位切换。支持 Scroll Snap (磁吸效果)，停止时卡片回弹对齐屏幕正中央。
- **横向滑动**：同一天多条记录时，左右滑动 (Swipe) 切换堆叠卡片，像翻阅相册。
- **点击卡片**：进入"编辑记录"页面。带有 active:scale 缩放反馈。
- **点击Add按钮**：弹出"新建记录"页面。带有 active:scale 缩放反馈。
- **触感反馈**：所有按钮和卡片点击均带有细腻的按压手感。

### 3.2 个人酒库页 (My Gallery)

#### 3.2.1 页面功能
- 展示用户的个人信息和统计数据
- 以照片墙形式展示所有酒品记录
- 提供快速浏览和访问记录的方式

#### 3.2.2 页面元素

**整体布局**
- **背景色**: 统一 iOS 系统级浅灰 #F2F2F7。
- **滚动结构**: 纵向滚动布局，底部预留 160px (pb-40) 留白，避免被 TabBar 遮挡。

**顶部导航栏 (Header)**
- **样式**: 高度 52px，固定顶部，高透磨砂玻璃 (Backdrop Blur XL)，下边缘极细分割线。
- **内容**: 正中央显示 "我的酒库" (黑色半粗体)。

**用户信息区域 (User Profile)**
- **位置**: 导航栏下方，随页面滚动，垂直居中对齐。
- **头像**: 直径 80px 圆形，2px 纯白边框 + 轻微投影 (Shadow-md)。
- **昵称**: 用户名称 (黑色粗体 20pt)。

**数据统计卡片 (Statistics Card)**
- **外观**: 纯白背景，圆角 16px，极淡弥散阴影。悬浮于背景之上，左右保留 16px 边距。
- **布局**: 三列均分，中间有未撑满的极细浅灰垂直分割线。
- **数据项**:
  - **第一列**: 纵向排列，蓝色高脚杯图标 + 已记录的总数 + 灰色标签 "总杯数"。
  - **第二列**: 纵向排列，橙色钱包图标 + 总花费金额数字，带货币符号 + 灰色标签 "总花费"。
  - **第三列**: 纵向排列，绿色日历图标 + 本月记录天数 + 灰色标签 "记录天数"。

**照片墙/酒单网格 (Photo Grid)**
- **布局**: 3列网格铺满屏幕宽度。
- **间距**: 1px 极细间隙，露出灰色背景形成自然分割。
- **图片样式**: 1:1 正方形裁剪 (Object Cover)。
- **加载占位**: 深灰色背景，避免闪烁。
- **空状态**: 居中显示巨大浅灰色酒杯图标 + "还没有记录哦"。

#### 3.2.3 交互逻辑

**页面加载**
1. 从本地存储读取所有记录
2. 计算统计数据：
   - 总杯数 = 所有记录的数量
   - 总花费 = 所有记录的价格之和
   - 记录天数 = 本月有创建记录的天数
3. 按创建时间倒序排列照片
4. 显示照片墙

**点击照片**
1. 点击任意照片，图片瞬间降低透明度 (Opacity 80%) 提供触感反馈。
2. 跳转到 "编辑笔记页" 。
3. 自动填充该条记录的所有信息（图片、评分、标签等）。

**切换到首页**
1. 点击底部导航栏的首页按钮
2. 切换到首页

**下拉刷新**
1. 用户下拉页面
2. 重新加载数据和统计
3. 刷新显示

#### 3.2.4 数据展示规则
- **统计数据格式**
  - 记录总数：整数（如：42）
  - 总花费：保留两位小数，添加货币符号（如：¥1,234.56）
  - 本月品鉴：整数（如：8）
- **照片墙排序**
  - 按创建时间倒序排列
  - 最新的照片在左上角
- **空值处理**
  - 如果某条记录没有价格，不计入总花费
  - 如果本月没有记录，显示0

### 3.3 创建和编辑记录页

#### 3.3.1 页面功能
- 新建或编辑酒品信息（复用同一页面结构）
- 模态页面风格 (Modal style)
- 包含输入校验和异常处理

#### 3.3.2 页面容器与动效
- **进入方式**：点击底部导航栏中间悬浮的“+”号按钮后，页面携带 `animate-slide-up` 动画，从底部平滑升起覆盖当前页面。
- **背景色**：延续全局的 iOS 系统浅灰 (#F2F2F7)，作为承载白色卡片的底板。
- **层级**：Z-Index 极高 (z-60)，确保覆盖住底部导航栏 (Tab Bar)。

#### 3.3.3 页面元素

**顶部导航栏 (Header)**
- **样式**: 固定在顶部，高度 52px，采用高透磨砂玻璃 (Backdrop Blur XL) 材质，下边缘带有极细的分割线。
- **左侧按钮**: "取消" (系统蓝 #007AFF 文字)。
- **标题**: "创建笔记" 或 "编辑笔记" (黑色半粗体，居中显示)。
- **右侧按钮**: 仅在编辑模式显示 "删除" 二字 (系统红 #FF3B30 文字)。

**照片上传区 (Photo)**
- **位置**: 页面最上方核心区域，引导用户首先通过视觉进行记录。
- **上传容器**:
  - 尺寸: 120x120px 圆角正方形 (Rounded-3xl)。
  - 位置: 水平居中，距离顶部导航栏有一定留白。
  - **默认态**: 纯白背景，中央显示灰色的相机图标 (IconCamera)，带有轻微投影。
  - **上传态**: 图片铺满容器 (Object Cover)。
- **修改图片按钮**:
  - 触发: 仅在图片上传后出现。
  - 样式: 照片容器右下角悬浮的圆形黑色按钮，内部白色铅笔图标。
  - 交互: 点击后支持重新上传。

**信息录入表单 (Form Groups)**
采用 "Inset Grouped" (内嵌分组) 风格，白色圆角卡片悬浮在灰色背景上。

1.  **核心信息组 (Core Info Group)**
    - **卡片样式**: 白色背景，圆角 12px。
    - **第一行 (酒名)**:
      - 左侧: 灰色铅笔图标 (IconPencil) + 黑色文字 "名称"。
      - 右侧: 无边框输入框，文字右对齐，占位符 "请输入酒品名称"。
      - 分割线: 底部有内部缩进的半透明细线。
    - **第二行 (评分)**:
      - 左侧: 灰色星星图标 (IconStar) + 黑色文字 "评分"。
      - 右侧: 5 颗可点击星星 (选中橙色 #FF9500，未选浅灰)。

2.  **详细信息组 (Details Group)**
    - **卡片样式**: 独立白色圆角卡片。
    - **第一行 (地点)**:
      - 左侧: 灰色定位图标 (IconLocation) + "地点"。
      - 右侧: 输入框，右对齐，占位符 "在哪里喝的？"。
    - **第二行 (价格)**:
      - 左侧: 灰色钱包图标 (IconWallet) + "价格"。
      - 右侧: 数字输入框，右对齐，前缀 "¥"，占位符 "0.00"。

3.  **标签组 (Tags Group)**
    - **卡片样式**: 白色圆角卡片。
    - **标题行**: 灰色标签图标 (IconTag) + "标签"。
    - **预设标签池**: 多行流式布局 (Flex Wrap)。
      - 样式：胶囊 (Chip)，圆角矩形。
      - 选中态: 系统蓝背景 (#007AFF) + 白色文字。自定义胶囊选中态在文字右侧有灰色"x"，支持用户删除该标签。
      - 未选态: 浅灰背景 (#E5E5EA) + 黑色文字。
      - 标签：预设标签只有这9个，不要自行创作。甜味、酸味、苦味、辛辣、果香、花香、坚果味、焦糖味、烟熏味
      - 自定义: "+自定义标签" 按钮，样式和其他标签一致，点击后唤起键盘支持用户自行输入标签内容。

4.  **描述组 (Description Group)**
    - **卡片样式**: 独立的大块白色区域。
    - **输入框**: 多行文本域 (Textarea)，无背景，字体较大，行高舒适。占位符"记录你的品鉴感受、配方、口感等..."

**底部悬浮操作栏 (Bottom Action Bar)**
- **位置**: 固定在屏幕底部，包含在 pb-32 的留白区域上方。
- **背景**: 高透磨砂玻璃 (#F2F2F7/90)，与顶部导航栏呼应。
- **保存按钮**:
  - 样式: 全宽大号按钮 (高度 50px)，圆角 14px。
  - 颜色: 系统蓝 (#007AFF) 背景，白色粗体文字 "提交"。
  - 质感: 蓝色弥散投影 (Shadow-lg)，点击缩放反馈 (Scale 0.98)。

#### 3.3.4 交互逻辑

**A. 图片上传**
1.  点击上传区域 -> 弹出 ActionSheet (拍照/相册/取消)。
2.  选择图片后 -> 压缩并预览。
3.  点击右下角修改按钮 -> 重新选择图片。

**B. 评分选择**
1.  点击第 N 颗星 -> 前 N 颗亮起 (实心橙色)，后续空心。
2.  再次点击第 N 颗星 (且当前评分为 N) -> 取消评分 (可选逻辑，或保持不变)。

**C. 标签选择**
1.  点击预设标签 -> 切换选中状态。
2.  点击 "+ 添加自定义标签" -> 弹窗输入 -> 确认后自动选中并加入列表。

**D. 保存流程**
1.  点击底部"提交"按钮。
2.  **执行校验** (见 3.3.4)。
3.  **校验通过**：
    *   若是新建：生成 ID，保存到 Storage，返回首页并刷新。
    *   若是编辑：更新记录，更新 `updatedAt`，保存，返回首页。
4.  **校验失败**：Toast 提示错误信息，不跳转。

**E. 删除流程 (仅编辑模式)**
1.  点击右上角"删除"文字。
2.  弹窗确认："确认删除？删除后无法恢复"。
3.  确认 -> 删除本地数据 -> 返回首页。

**F. 取消/返回**
1.  点击左上角 "取消"。
2.  若有未保存的修改 -> 弹窗 "确定放弃编辑吗？" -> 确认则返回，取消则停留。
3.  若无修改 -> 直接返回。

#### 3.3.5 数据验证与异常处理

**输入校验规则**
1.  **图片 (必填)**: 必须包含一张图片。校验失败提示："请上传照片"。
2.  **名称 (必填)**: 不能为空，且去除首尾空格后长度 > 0。校验失败提示："请输入酒品名称"。
3.  **评分 (必填)**: 必须 > 0。校验失败提示："请选择评分"。
4.  **价格 (可选)**: 若填写，必须为非负数。输入框限制只能输入数字和小数点。
5.  **字数限制**: 名称(50)、地点(100)、笔记(1000)、标签(20)。前端截断或禁止继续输入。

**异常处理**
1.  **图片过大**: 选择图片 > 2MB 时，自动压缩；若仍过大，提示"图片太大，请重新选择"。
2.  **存储满**: `wx.setStorage` 报错时，提示"存储空间不足，请清理微信缓存"。
3.  **ID冲突**: 极低概率。生成 ID 时若检测到已存在，自动重试生成。

## 4. 业务流程图

### 4.1 核心操作流程
```
[首页] -> 点击 "+" -> [新建页] -> 拍照/填表 -> 保存 -> [首页(刷新)]
[首页] -> 点击卡片 -> [编辑页] -> 修改信息 -> 保存 -> [首页(刷新)]
[编辑页] -> 点击删除 -> 确认 -> [首页(刷新)]
```

## 5. 异常处理

### 5.1 输入验证异常

**空白名称**
- 触发条件：保存时名称为空或仅包含空格
- 处理方式：显示提示"请输入酒品名称"，不执行保存

**价格格式错误**
- 触发条件：输入非数字字符
- 处理方式：输入框限制为数字键盘，自动过滤非法字符

**字数超限**
- 触发条件：输入超过字数限制
- 处理方式：输入框限制最大长度，超出部分无法输入

### 5.2 存储异常

**存储空间不足**
- 触发条件：本地存储空间已满
- 处理方式：
  - 显示提示："存储空间不足，请清理数据"
  - 保持当前编辑状态
  - 不执行保存操作

**存储写入失败**
- 触发条件：wx.setStorage 调用失败
- 处理方式：
  - 显示提示："保存失败，请重试"
  - 保留用户输入
  - 允许用户重新保存

**数据读取失败**
- 触发条件：wx.getStorage 调用失败
- 处理方式：
  - 尝试从备份恢复
  - 如果恢复失败，初始化为空数据
  - 显示提示："数据加载失败，请下拉刷新重试"

### 5.3 数据完整性异常

**记录缺少必填字段**
- 触发条件：从存储读取的记录缺少name字段
- 处理方式：自动补充默认值"未命名"

**记录ID冲突**
- 触发条件：生成的ID已存在
- 处理方式：重新生成ID直到唯一

**时间戳异常**
- 触发条件：时间戳为空或大于当前时间
- 处理方式：使用当前时间替换

**标签数据损坏**
- 触发条件：tags字段不是数组
- 处理方式：重置为空数组

### 5.4 图片处理异常

**图片选择失败**
- 触发条件：wx.chooseImage 调用失败
- 处理方式：
  - 显示提示："图片选择失败"
  - 允许用户重新选择

**图片过大**
- 触发条件：图片文件大于2MB
- 处理方式：
  - 自动压缩图片
  - 如果压缩后仍超过限制，提示用户选择其他图片

**图片格式不支持**
- 触发条件：选择的文件不是图片格式
- 处理方式：显示提示"仅支持JPG、PNG格式"

**图片加载失败**
- 触发条件：图片资源损坏或本地文件丢失
- 处理方式：
  - 显示默认的灰色占位图（酒杯图标）
  - 在编辑页允许用户重新上传图片

## 6. 附录

### 6.1 术语表
- 酒品记录：用户创建的单条酒类饮品记录
- 酒品库：用户所有酒品记录的集合
- 预设标签：系统提供的常用标签
- 自定义标签：用户自行创建的标签
- 本地存储：微信小程序的 wx.storage API
- 图标库: 类似 SF Symbols 的线性风格。
- 字体: 中文 PingFang SC，英文 San Francisco。

### 6.2 参考资料
- 微信小程序开发文档
- 微信小程序设计规范
- 用户研究报告
