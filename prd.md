# 产品需求文档（PRD）
# 微醺笔记 MVP 版本

## 1. 产品概述

### 1.1 产品定位
微醺笔记是一款专注于个人酒品记录的微信小程序，帮助用户记录每一杯喝过或调制过的酒，建立个人的酒品档案库。

### 1.2 目标用户
- 酒类爱好者：经常品鉴各类酒品，希望记录品鉴体验
- 调酒爱好者：在家调酒，需要记录配方和心得
- 社交饮酒者：在酒吧、餐厅等场所饮酒，想记住喜欢的酒

### 1.3 核心价值
- 解决"不知道喝什么"的问题：通过历史记录快速找到喜欢的酒
- 解决"记不住酒的信息"的问题：完整记录每杯酒的详细信息
- 解决"不知道能做什么"的问题：通过配方笔记查看可调制的酒品

### 1.4 MVP范围
本MVP版本专注于核心记录功能，包括：
- 创建和管理酒品记录
- 翻页式浏览酒品记录（模拟酒单小册子）
- 个人酒库统计分析
- 本地数据存储

暂不包括：搜索筛选、云同步、社交分享等功能

## 2. 功能架构

### 2.1 功能模块划分
```
微醺笔记
├── 首页模块
│   ├── 翻页式记录展示（模拟酒单小册子）
│   ├── 日期书签导航
│   └── 空状态引导
├── 个人酒库模块
│   ├── 用户信息展示
│   ├── 统计数据展示
│   └── 照片墙列表
├── 记录管理模块
│   ├── 创建记录
│   ├── 编辑记录
│   └── 删除记录
├── 标签系统模块
│   ├── 预设标签选择
│   └── 自定义标签管理
└── 数据存储模块
    ├── 本地存储
    └── 数据验证
```

### 2.2 页面结构
```
首页（翻页式酒单）
├── 创建记录页
└── 编辑记录页
    └── 删除确认（弹窗）

个人酒库页
└── 照片墙列表
```

## 3. 页面详细设计

### 3.1 首页（翻页式酒单）

#### 3.1.1 页面功能
- 以翻页小册子的形式展示酒品记录
- 模拟酒吧酒单的浏览体验
- 通过日期书签快速导航
- 提供创建新记录的入口

#### 3.1.2 页面元素

**顶部区域**
- 标题："微醺笔记"
- 用户头像（左侧圆形头像）
- 问候语：根据时间段变化
  - 6:00-11:00："早安，准备喝点什么？"
  - 11:00-14:00："午后时光，小酌一杯？"
  - 14:00-18:00："下午好，要不要喝点什么？"
  - 18:00-22:00："夜幕降临，来一杯吧"
  - 22:00-6:00："夜深了，来一杯吗？"

**记录卡片区域**（模拟小册子翻页）
- 卡片以层叠方式展示，最新记录在最上层
- 每页只显示一张卡片
- 卡片内容：
  - 酒品照片（占据卡片主要区域）
  - 酒品名称（照片下方，加粗显示）
  - 评分星星（名称下方）
  - 关键标签（最多显示3个标签气泡）
  - 一句话短评（标签下方，灰色文字）
  - 创建时间（卡片底部，小字）

**日期书签区域**（右侧边缘）
- 垂直排列的日期标签
- 显示格式："MM-DD"
- 当前显示的卡片对应的日期高亮
- 点击书签可跳转到对应日期的记录

**底部导航栏**（固定在底部）
- 首页按钮：图标 + "首页"文字（左侧）
- 创建按钮："+" 大圆形按钮（居中，突出显示）
- 个人酒库按钮：图标 + "酒库"文字（右侧）

**空状态**
- 当没有任何记录时显示
- 内容：酒杯插图 + 文案"还没有记录，点击下方 + 开始记录第一杯酒"


#### 3.1.3 交互逻辑

**页面加载**
1. 进入页面时，从本地存储读取所有酒品记录
2. 按创建时间倒序排列（最新的在最上层）
3. 生成日期书签列表（去重后的日期）
4. 显示最新的记录卡片
5. 如果没有记录，显示空状态引导

**翻页交互**
1. 左滑：切换到下一张（更早的）记录卡片
   - 卡片从右侧滑入，当前卡片向左滑出
   - 更新日期书签的高亮状态
2. 右滑：切换到上一张（更新的）记录卡片
   - 卡片从左侧滑入，当前卡片向右滑出
   - 更新日期书签的高亮状态
3. 滑动到第一张时，无法继续右滑
4. 滑动到最后一张时，无法继续左滑

**日期书签导航**
1. 点击某个日期书签
2. 卡片切换到该日期的第一条记录
3. 使用淡入淡出动画效果
4. 更新书签高亮状态

**点击记录卡片**
1. 点击卡片任意位置
2. 跳转到编辑记录页
3. 预填充该记录的所有数据

**点击创建按钮**
1. 点击底部"+"按钮
2. 跳转到创建记录页

**点击个人酒库按钮**
1. 点击底部导航栏的个人酒库按钮
2. 跳转到个人酒库页

**点击首页按钮**
1. 在其他页面点击底部导航栏的首页按钮
2. 返回首页

**下拉刷新**
1. 用户在卡片区域下拉
2. 重新从本地存储加载数据
3. 刷新卡片显示和日期书签

#### 3.1.4 数据展示规则

**照片显示**
- 必填字段，始终显示照片
- 照片占据卡片主要区域（约60%高度）

**评分显示**
- 必填字段，始终显示评分星星
- 显示1-5颗实心星星

**标签显示**
- 最多显示3个关键标签
- 优先显示口味、口感、风味类标签
- 标签以气泡形式横向排列

**短评显示**
- 从品鉴笔记中提取第一句话（最多30字）
- 如果没有笔记，则省略不展示

**日期书签**
- 按日期分组，每个日期显示一个书签
- 同一天的多条记录共用一个书签
- 书签按时间倒序排列

**卡片排序**
- 始终按创建时间倒序排列
- 最新创建的记录在最上层（第一张）

### 3.2 个人酒库页

#### 3.2.1 页面功能
- 展示用户的个人信息和统计数据
- 以照片墙形式展示所有酒品记录
- 提供快速浏览和访问记录的方式

#### 3.2.2 页面元素

**顶部导航栏**
- 标题："个人酒库"（居中）

**用户信息区域**
- 用户头像（大尺寸圆形头像，居中）
- 用户昵称（头像下方）

**统计数据区域**（三列布局）
- 第一列：
  - 数字：记录总数
  - 标签："喝过的酒"
- 第二列：
  - 数字：总花费金额
  - 标签："总花费"
- 第三列：
  - 数字：本月记录数
  - 标签："本月品鉴"

**照片墙区域**
- 网格布局（3列）
- 每个格子显示酒品照片
- 照片为长方形，等间距排列
- 点击照片可进入编辑页

**空状态**
- 当没有记录时显示
- 内容："还没有记录哦"

#### 3.2.3 交互逻辑

**页面加载**
1. 从本地存储读取所有记录
2. 计算统计数据：
   - 记录总数 = 所有记录的数量
   - 总花费 = 所有记录的价格之和
   - 本月品鉴 = 本月创建的记录数量
3. 按创建时间倒序排列照片
4. 显示照片墙

**点击照片**
1. 点击照片墙中的任意照片
2. 跳转到该记录的编辑页
3. 预填充该记录的所有数据

**切换到首页**
1. 点击底部导航栏的首页按钮
2. 切换到首页

**下拉刷新**
1. 用户下拉页面
2. 重新加载数据和统计
3. 刷新显示

#### 3.2.4 数据展示规则

**统计数据格式**
- 记录总数：整数（如：42）
- 总花费：保留两位小数，添加货币符号（如：¥1,234.56）
- 本月品鉴：整数（如：8）

**照片墙排序**
- 按创建时间倒序排列
- 最新的照片在左上角

**空值处理**
- 如果某条记录没有价格，不计入总花费
- 如果本月没有记录，显示0

### 3.3 创建记录页

#### 3.3.1 页面功能
- 创建新的酒品记录
- 填写酒品的各项信息
- 保存记录到本地存储

#### 3.3.2 页面元素

**顶部导航栏**
- 左侧按钮："取消"
- 标题："新建记录"

**表单区域（从上到下，可滚动）**

1. **照片上传区域**
   - 大的正方形区域
   - 必填标识："*"（红色，右上角）
   - 未上传时：显示虚线边框 + "点击添加照片"文字 + 相机图标
   - 已上传时：显示照片预览 + 右上角删除按钮（×）

2. **酒品名称输入框**
   - 标签："酒品名称"
   - 必填标识："*"（红色）
   - 输入框：单行文本输入
   - 占位符："请输入酒品名称"
   - 字数限制：50字

3. **评分选择器**
   - 标签："评分"
   - 必填标识："*"（红色）
   - 5个星星图标，可点击选择
   - 默认未选中状态（空心星星）
   - 点击后变为实心星星
   - 支持选择1-5星

4. **标签选择区域**
   - 标签："标签"
   - 分类标签页（横向滚动）：
     - 口味口感（合并）
     - 风味
     - 自定义
   - 标签列表（当前分类下的所有标签）
   - 标签以气泡形式展示
   - 已选中的标签：实心背景
   - 未选中的标签：空心边框
   - 自定义分类下有"+ 添加自定义标签"按钮

5. **地点输入框**
   - 标签："地点"
   - 输入框：单行文本输入
   - 占位符："在哪里喝的？"
   - 字数限制：100字

6. **价格输入框**
   - 标签："价格"
   - 输入框：数字输入
   - 占位符："多少钱？"
   - 输入类型：数字键盘
   - 前缀："¥"符号

7. **品鉴笔记输入框**
   - 标签："品鉴笔记"
   - 输入框：多行文本输入
   - 占位符："记录你的品鉴感受、配方、口感等..."
   - 字数限制：1000字
   - 显示当前字数

**底部固定区域**
- 保存按钮（大按钮，占满宽度）

#### 3.3.3 交互逻辑

**页面进入**
1. 从首页点击创建按钮进入
2. 所有字段为空状态
3. 光标自动聚焦到酒品名称输入框

**照片上传**
1. 点击照片上传区域
2. 弹出选择菜单：
   - "从相册选择"
   - "拍照"
   - "取消"
3. 选择照片后，显示照片预览
4. 点击右上角删除按钮可移除照片

**评分选择**
1. 点击第N个星星
2. 前N个星星变为实心，后面的保持空心
3. 再次点击同一个星星，取消评分（所有星星变空心）

**标签选择**
1. 默认显示"口味口感"分类的标签
2. 点击分类标签页切换到其他分类
3. 点击未选中的标签，标签变为选中状态（实心背景）
4. 点击已选中的标签，标签变为未选中状态（空心边框）
5. 在"自定义"分类下：
   - 点击"+ 添加自定义标签"
   - 弹出输入框
   - 输入标签文字后确认
   - 新标签自动选中并添加到自定义标签列表

**保存记录**
1. 点击底部"保存"按钮
2. 验证必填字段：
   - 如果照片未上传：显示提示"请上传照片"
   - 如果酒品名称为空或仅包含空格：显示提示"请输入酒品名称"
   - 如果评分未选择：显示提示"请选择评分"
   - 如果验证失败：不执行保存，停留在当前页面
   - 如果验证通过：
     - 生成唯一ID
     - 保存所有字段到本地存储
     - 返回首页
     - 在首页最上层显示新创建的记录

**取消创建**
1. 点击左上角"取消"按钮
2. 如果用户已输入任何内容：
   - 弹出确认对话框："确定放弃编辑吗？"
   - 选项："放弃" / "继续编辑"
   - 点击"放弃"：返回首页
   - 点击"继续编辑"：关闭对话框，停留在当前页面
3. 如果用户未输入任何内容：
   - 直接返回首页

#### 3.3.4 数据验证规则

**照片**
- 必填
- 必须上传一张照片

**酒品名称**
- 必填
- 去除首尾空格后不能为空
- 最大长度50字

**评分**
- 必填
- 必须是1-5之间的整数

**价格**
- 可选
- 如果填写，必须是大于等于0的数字
- 支持小数（最多2位）

**地点**
- 可选
- 最大长度100字

**品鉴笔记**
- 可选
- 最大长度1000字

**标签**
- 可选
- 最多选择10个标签
- 每个标签最大长度20字

### 3.4 编辑记录页

#### 3.4.1 页面功能
- 修改已有酒品记录的信息
- 删除酒品记录
- 保存修改到本地存储

#### 3.4.2 页面元素
与创建记录页基本相同，区别：
- 导航栏标题："编辑记录"
- 导航栏右侧增加："删除"按钮（垃圾桶图标）
- 所有字段预填充现有数据

#### 3.4.3 交互逻辑

**页面进入**
1. 从首页点击记录卡片进入
2. 所有字段预填充该记录的现有数据
3. 照片、评分、标签等都显示当前值

**字段编辑**
- 所有字段都可以修改
- 可以更换照片、修改评分、修改标签
- 可以添加或删除标签

**保存修改**
1. 点击底部"保存"按钮
2. 验证必填字段（同创建页）
3. 如果验证通过：
   - 更新记录的所有字段
   - 更新 updatedAt 时间戳
   - 保存到本地存储
   - 返回首页
   - 在首页显示更新后的记录

**删除记录**
1. 点击右上角"删除"按钮
2. 弹出确认对话框：
   - 标题："确认删除"
   - 内容："删除后无法恢复，确定要删除这条记录吗？"
   - 按钮："取消" / "删除"（红色）
3. 点击"删除"：
   - 从本地存储删除该记录
   - 显示提示："已删除"
   - 返回首页
4. 点击"取消"：
   - 关闭对话框
   - 停留在编辑页

**取消编辑**
1. 点击左上角"取消"按钮
2. 如果用户修改了任何内容：
   - 弹出确认对话框："确定放弃修改吗？"
   - 选项："放弃" / "继续编辑"
   - 点击"放弃"：返回首页，不保存修改
   - 点击"继续编辑"：关闭对话框，停留在编辑页
3. 如果用户未修改任何内容：
   - 直接返回首页

#### 3.4.4 数据处理

**修改检测**
- 对比当前表单数据与原始记录数据
- 如果任何字段发生变化，标记为"已修改"

**时间戳更新**
- 保存时更新 updatedAt 字段为当前时间
- createdAt 字段保持不变

### 3.5 预设标签列表

**口味口感类（合并）**
甜味、酸味、苦味、辛辣、清爽、浓郁、顺滑、醇厚、轻盈、绵密、爽脆、柔和、刺激

**风味类**
果香、花香、木质香、香料味、坚果味、焦糖味、草本味、烟熏味

## 4. 数据结构设计

### 4.1 酒品记录数据结构

```javascript
{
  id: "1705318800000_abc123",        // 唯一标识符
  name: "莫吉托",                     // 酒品名称（必填）
  photo: "/images/wine_001.jpg",     // 照片路径（必填）
  rating: 4,                          // 评分 1-5（必填）
  location: "某某酒吧",               // 地点（可选）
  price: 68,                          // 价格（可选）
  notes: "清爽的薄荷味...",           // 品鉴笔记（可选）
  tags: ["清爽", "薄荷", "果香"],     // 标签数组（可选）
  createdAt: 1705318800000,          // 创建时间戳
  updatedAt: 1705318800000           // 更新时间戳
}
```

### 4.2 本地存储结构

**主数据存储键**：`wine_records`
```javascript
{
  "record_id_1": { /* 记录对象 */ },
  "record_id_2": { /* 记录对象 */ },
  ...
}
```

**自定义标签存储键**：`custom_tags`
```javascript
["自定义标签1", "自定义标签2", ...]
```

**元数据存储键**：`metadata`
```javascript
{
  version: "1.0.0",
  lastSync: 1705318800000,
  recordCount: 10
}
```

### 4.3 ID生成规则
- 格式：`时间戳_随机字符串`
- 示例：`1705318800000_abc123`
- 确保全局唯一性

## 5. 业务流程

### 5.1 创建记录流程

```
用户进入首页
    ↓
点击底部"+"按钮
    ↓
进入创建记录页
    ↓
填写酒品信息
    ├→ 上传照片（必填）
    ├→ 输入名称（必填）
    ├→ 选择评分（必填）
    ├→ 选择标签（可选）
    ├→ 输入地点（可选）
    ├→ 输入价格（可选）
    └→ 输入笔记（可选）
    ↓
点击底部"保存"按钮
    ↓
验证必填字段
    ├→ 验证失败：显示错误提示
    └→ 验证成功：
        ↓
    生成唯一ID
        ↓
    保存到本地存储
        ↓
    返回首页
        ↓
    在首页最上层显示新记录
```

### 5.2 编辑记录流程

```
用户在首页
    ↓
点击记录卡片
    ↓
进入编辑页（预填充数据）
    ↓
修改信息
    ↓
点击底部"保存"按钮
    ↓
验证必填字段
    ├→ 验证失败：显示错误提示
    └→ 验证成功：
        ↓
    更新记录数据
        ↓
    更新时间戳
        ↓
    保存到本地存储
        ↓
    返回首页（显示更新后数据）
```

### 5.3 删除记录流程

```
用户在编辑页
    ↓
点击右上角"删除"按钮
    ↓
弹出确认对话框
    ├→ 点击"取消"：关闭对话框
    └→ 点击"删除"：
        ↓
    从本地存储删除记录
        ↓
    显示"已删除"提示
        ↓
    返回首页
```

### 5.4 标签选择流程

```
用户在创建/编辑页
    ↓
查看标签区域
    ↓
选择标签分类（口味口感/风味/自定义）
    ↓
选择标签
    ├→ 选择预设标签：
    │   ↓
    │   点击标签，标签变为选中状态
    │   ↓
    │   标签添加到已选列表
    │
    └→ 创建自定义标签：
        ↓
    切换到"自定义"分类
        ↓
    点击"+ 添加自定义标签"
        ↓
    弹出输入框
        ↓
    输入标签文字
        ↓
    点击"确定"
        ↓
    验证标签
        ├→ 验证失败：显示错误提示
        └→ 验证成功：
            ↓
        保存到自定义标签列表
            ↓
        自动选中该标签
```

### 5.5 查看个人酒库流程

```
用户在首页
    ↓
点击底部导航栏的个人酒库按钮
    ↓
切换到个人酒库页
    ↓
查看统计数据和照片墙
    ↓
点击某张照片
    ↓
进入该记录的编辑页
```

### 5.6 底部导航切换流程

```
用户在任意页面
    ↓
点击底部导航栏按钮
    ├→ 点击首页按钮：切换到首页
    ├→ 点击创建按钮：进入创建记录页
    └→ 点击酒库按钮：切换到个人酒库页
```

## 6. 异常处理

### 6.1 输入验证异常

**空白名称**
- 触发条件：保存时名称为空或仅包含空格
- 处理方式：显示提示"请输入酒品名称"，不执行保存

**价格格式错误**
- 触发条件：输入非数字字符
- 处理方式：输入框限制为数字键盘，自动过滤非法字符

**字数超限**
- 触发条件：输入超过字数限制
- 处理方式：输入框限制最大长度，超出部分无法输入

### 6.2 存储异常

**存储空间不足**
- 触发条件：本地存储空间已满
- 处理方式：
  - 显示提示："存储空间不足，请清理数据"
  - 保持当前编辑状态
  - 不执行保存操作

**存储写入失败**
- 触发条件：wx.setStorage 调用失败
- 处理方式：
  - 显示提示："保存失败，请重试"
  - 保留用户输入
  - 允许用户重新保存

**数据读取失败**
- 触发条件：wx.getStorage 调用失败
- 处理方式：
  - 尝试从备份恢复
  - 如果恢复失败，初始化为空数据
  - 显示提示："数据加载失败"

### 6.3 数据完整性异常

**记录缺少必填字段**
- 触发条件：从存储读取的记录缺少name字段
- 处理方式：自动补充默认值"未命名"

**记录ID冲突**
- 触发条件：生成的ID已存在
- 处理方式：重新生成ID直到唯一

**时间戳异常**
- 触发条件：时间戳为空或大于当前时间
- 处理方式：使用当前时间替换

**标签数据损坏**
- 触发条件：tags字段不是数组
- 处理方式：重置为空数组

### 6.4 图片处理异常

**图片选择失败**
- 触发条件：wx.chooseImage 调用失败
- 处理方式：
  - 显示提示："图片选择失败"
  - 允许用户重新选择

**图片过大**
- 触发条件：图片文件大于2MB
- 处理方式：
  - 自动压缩图片
  - 如果压缩后仍超过限制，提示用户选择其他图片

**图片格式不支持**
- 触发条件：选择的文件不是图片格式
- 处理方式：显示提示"仅支持JPG、PNG格式"

## 7. 性能要求

### 7.1 响应时间
- 页面加载：< 1秒
- 列表渲染：< 500ms
- 保存操作：< 300ms
- 图片上传：< 2秒

### 7.2 数据容量
- 单个记录大小：< 5MB（包含图片）
- 总记录数：支持至少500条
- 图片数量：每条记录1张
- 标签数量：每条记录最多10个

### 7.3 兼容性
- 微信版本：7.0.0 及以上
- 基础库版本：2.0.0 及以上
- 支持iOS和Android平台

## 8. 附录

### 8.1 术语表
- 酒品记录：用户创建的单条酒类饮品记录
- 酒品库：用户所有酒品记录的集合
- 预设标签：系统提供的常用标签
- 自定义标签：用户自行创建的标签
- 本地存储：微信小程序的 wx.storage API

### 8.2 参考资料
- 微信小程序开发文档
- 微信小程序设计规范
- 用户研究报告

---

**文档版本**：V1.0  
**创建日期**：2024-01-15  
**最后更新**：2024-01-15  
**文档状态**：待评审
