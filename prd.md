# 产品需求文档（PRD）
# 微醺笔记 (Drinking Diary) MVP 版本

## 1. 产品概述

### 1.1 产品定位
微醺笔记是一款专注于个人酒品记录的微信小程序，帮助用户记录每一杯喝过或调制过的酒，建立个人的酒品档案库。

### 1.2 目标用户
- 酒类爱好者：经常品鉴各类酒品，希望记录品鉴体验
- 调酒爱好者：在家调酒，需要记录配方和心得
- 社交饮酒者：在酒吧、餐厅等场所饮酒，想记住喜欢的酒

### 1.3 核心价值
- 解决"不知道喝什么"的问题：通过历史记录快速找到喜欢的酒
- 解决"记不住酒的信息"的问题：完整记录每杯酒的详细信息
- 解决"不知道能做什么"的问题：通过配方笔记查看可调制的酒品

### 1.4 MVP范围
本MVP版本专注于核心记录功能，包括：
- 创建和管理酒品记录
- 首页卡片式浏览（支持按日期纵向浏览，同日记录横向切换）
- 个人酒库统计分析
- 本地数据存储

暂不包括：搜索筛选、云同步、社交分享等功能

### 1.5 视觉设计规范 (Visual Guidelines)
- **色彩体系**：
  - 主色调 (Brand Blue): `#007AFF` (用于按钮、选中状态、强调色)
  - 背景色 (Background): `#F2F2F7` (iOS 风格浅灰背景)
  - 卡片背景 (Card Bg): `#FFFFFF`
  - 文本颜色 (Text): 
    - 主要: `#000000` (90% opacity)
    - 次要: `#3C3C43` (60% opacity)
    - 辅助: `#999999`
  - 评分星星: `#FF9500`
  - 标签背景: `#E5E5EA` (未选中), `#007AFF` (选中)
- **圆角与阴影**：
  - 卡片圆角: `16px`
  - 按钮圆角: `12px` 或 Pill shape
  - 卡片阴影: `0 8px 20px rgba(0,0,0,0.08)`
- **字体**：
  - 遵循系统默认字体 (San Francisco / PingFang SC)
  - 标题字重: Semibold / Bold
  - 正文字重: Regular / Medium

## 2. 功能架构

### 2.1 功能模块划分
```
微醺笔记
├── 首页模块
│   ├── 问候语与头像栏
│   ├── 卡片式记录展示 (纵向日期流 + 横向堆叠)
│   └── 空状态引导
├── 个人酒库模块
│   ├── 用户信息展示 (头像/昵称)
│   ├── 核心数据统计 (总杯数/总花费/记录天数)
│   └── 照片墙列表 (3列网格)
├── 记录管理模块
│   ├── 创建记录
│   ├── 编辑记录
│   └── 删除记录
└── 标签系统模块
    ├── 预设标签选择
    ├── 自定义标签输入
    └── 标签状态管理
```

### 2.2 页面结构
```
App
├── 底部导航栏 (TabBar)
│   ├── 首页 (Home)
│   ├── 新建 (+) - 模态弹窗
│   └── 个人 (Profile)
├── 首页 (Home View)
├── 编辑/新建页 (Editor View)
└── 个人页 (Profile View)
```

## 3. 页面详细设计

### 3.1 首页 (Home View)

#### 3.1.1 页面功能
- 展示用户的酒品记录卡片
- 支持二维导航：纵向切换日期，横向切换同一天的不同记录
- 快速预览酒品信息（图、名、分、评、标签）

#### 3.1.2 页面元素

**顶部区域**
- 标题栏："微醺笔记"
- 用户头像（右侧圆形头像）
- 问候语：根据时间段变化
  - 6:00-11:00："早安，准备喝点什么？"
  - 11:00-14:00："午后时光，小酌一杯？"
  - 14:00-18:00："下午好，要不要喝点什么？"
  - 18:00-22:00："夜幕降临，来一杯吧"
  - 22:00-6:00："夜深了，来一杯吗？"

**记录卡片区域**
- **布局**：卡片居中，占据屏幕大部分高度 (约 65vh)。
- **卡片内容**：
  - **图片区** (上部 60%)：
    - 全屏宽图片，Cover 模式裁剪
    - **日期标签** (Date Tag): 黑色半圆角矩形，位于图片区域右侧边缘中部，显示日期 (如 "10.24")，当前显示的卡片对应的日期高亮，点击书签可跳转到对应日期的记录
  - **信息区** (下部 40%)：
    - 标题：酒品名称 (居中, Bold, 22px)
    - 评分：5颗星星 (居中, 橙色 #FF9500)
    - 描述：一句话短评 (居中, 灰色, 限制2行)
    - 底部栏：
      - 左侧：标签行 (横向滚动, 灰色胶囊样式)
      - 右侧：具体时间 (如 "20:30", 灰色小字)
- **空状态**
  - 当没有任何记录时显示
  - 内容：酒杯插图 + 文案"还没有记录，点击下方 + 开始记录第一杯酒"

**底部导航栏 (Fixed Bottom)**
- 背景：高斯模糊 (Backdrop blur)
- 按钮：
  - Home (左): 屋子图标
  - Add (中): 悬浮大圆钮，蓝色背景 (#007AFF)，白色加号
  - Profile (右): 人像图标
- 选中状态：图标变蓝 (#007AFF)

#### 3.1.3 交互逻辑
- **纵向滑动**：切换不同日期的记录组。
- **横向滑动**：当某一天有多条记录时，卡片呈堆叠状，左右滑动切换查看同一天的不同记录。滑动到第一张时，无法继续右滑，滑动到最后一张时，无法继续左滑。
- **点击卡片**：进入"编辑记录"页面。
- **点击Add按钮**：弹出"新建记录"页面。

### 3.2 个人酒库页 (My Gallery)

#### 3.2.1 页面功能
- 展示用户的个人信息和统计数据
- 以照片墙形式展示所有酒品记录
- 提供快速浏览和访问记录的方式

#### 3.2.2 页面元素

**顶部导航栏**
- 标题："个人酒库"（居中）

**用户信息区域**
- 用户头像（大尺寸圆形头像，居中）
- 用户昵称（头像下方）

**统计数据区域**（三列布局）
- 卡片式容器，圆角矩形
- 第一列：
  - 数字：记录总数
  - 标签："总杯数"
- 第二列：
  - 数字：总花费金额
  - 标签："总花费"
- 第三列：
  - 数字：本月记录天数
  - 标签："记录天数"

**照片墙区域**
- 网格布局（3列）
- 每个格子显示酒品照片
- 照片为长方形，等间距排列
- 点击照片可进入编辑页

**空状态**
- 当没有记录时显示
- 内容："还没有记录哦"

#### 3.2.3 交互逻辑

**页面加载**
1. 从本地存储读取所有记录
2. 计算统计数据：
   - 记录总数 = 所有记录的数量
   - 总花费 = 所有记录的价格之和
   - 本月品鉴 = 本月记录天数
3. 按创建时间倒序排列照片
4. 显示照片墙

**点击照片**
1. 点击照片墙中的任意照片
2. 跳转到该记录的编辑页
3. 预填充该记录的所有数据

**切换到首页**
1. 点击底部导航栏的首页按钮
2. 切换到首页

**下拉刷新**
1. 用户下拉页面
2. 重新加载数据和统计
3. 刷新显示

#### 3.2.4 数据展示规则
- **统计数据格式**
  - 记录总数：整数（如：42）
  - 总花费：保留两位小数，添加货币符号（如：¥1,234.56）
  - 本月品鉴：整数（如：8）
- **照片墙排序**
  - 按创建时间倒序排列
  - 最新的照片在左上角
- **空值处理**
  - 如果某条记录没有价格，不计入总花费
  - 如果本月没有记录，显示0

### 3.3 创建和编辑记录页

#### 3.3.1 页面功能
- 新建或编辑酒品信息（复用同一页面结构）
- 模态页面风格 (Modal style)
- 包含输入校验和异常处理

#### 3.3.2 页面元素

**顶部导航**
- 左侧: "取消" (蓝色文字)
- 标题: "新建笔记" 或 "编辑笔记" (居中, 加粗)
- 右侧: 垃圾桶图标 (仅在编辑模式出现, 红色)

**表单内容 (滚动区域)**

1.  **图片上传区** (Card 1)
    *   大正方形/圆角矩形区域
    *   必填标识："*" (红色)
    *   空状态: 灰色背景 + 相机图标 + "点击添加照片"
    *   有图状态: 显示图片全貌 + 右上角删除按钮 (×)

2.  **基础信息卡片** (Card 2)
    *   **酒品名称**:
        *   标签: 图标 + "酒品名称" + "*"
        *   控件: 单行输入框，Placeholder "请输入酒品名称"，限50字
    *   **评分**:
        *   标签: 图标 + "评分" + "*"
        *   控件: 5星交互控件，点选

3.  **详细信息卡片** (Card 3)
    *   **地点**:
        *   标签: 地标图标 + "地点"
        *   控件: 单行输入框，Placeholder "在哪里喝的？"
    *   **价格**:
        *   标签: 钱包图标 + "价格"
        *   控件: 数字键盘输入框，前缀 "¥"，Placeholder "0.00"

4.  **标签与笔记卡片** (Card 4)
    *   **标签**:
        *   标题: 标签图标 + "标签"
        *   预设标签: 甜味、酸味、苦味、辛辣、果香、花香、香料味、坚果味、焦糖味、烟熏味
        *   标签流: 气泡样式 (未选灰底黑字，选中蓝底白字带×)
        *   自定义: "+ 添加自定义标签" 按钮
    *   **品鉴笔记**:
        *   标题: "品鉴笔记"
        *   控件: 多行文本区域，无边框，Placeholder "记录你的品鉴感受、配方、口感等..."，限1000字

**底部操作栏**
- 按钮: "保存" (新建时) 或 "保存修改" (编辑时)
- 样式: 蓝色大圆角按钮 (#007AFF)，全宽，固定底部

#### 3.3.3 交互逻辑

**A. 图片上传**
1.  点击上传区域 -> 弹出 ActionSheet (拍照/相册/取消)。
2.  选择图片后 -> 压缩并预览。
3.  点击删除按钮 -> 清空图片，恢复空状态。

**B. 评分选择**
1.  点击第 N 颗星 -> 前 N 颗亮起 (实心橙色)，后续空心。
2.  再次点击第 N 颗星 (且当前评分为 N) -> 取消评分 (可选逻辑，或保持不变)。

**C. 标签选择**
1.  点击预设标签 -> 切换选中状态。
2.  点击 "+ 添加自定义标签" -> 弹窗输入 -> 确认后自动选中并加入列表。

**D. 保存流程**
1.  点击底部保存按钮。
2.  **执行校验** (见 3.3.4)。
3.  **校验通过**：
    *   若是新建：生成 ID，保存到 Storage，返回首页并刷新。
    *   若是编辑：更新记录，更新 `updatedAt`，保存，返回首页。
4.  **校验失败**：Toast 提示错误信息，不跳转。

**E. 删除流程 (仅编辑模式)**
1.  点击右上角垃圾桶。
2.  弹窗确认："确认删除？删除后无法恢复"。
3.  确认 -> 删除本地数据 -> 返回首页。

**F. 取消/返回**
1.  点击 "取消"。
2.  若有未保存的修改 -> 弹窗 "确定放弃编辑吗？" -> 确认则返回，取消则停留。
3.  若无修改 -> 直接返回。

#### 3.3.4 数据验证与异常处理

**输入校验规则**
1.  **图片 (必填)**: 必须包含一张图片。校验失败提示："请上传照片"。
2.  **名称 (必填)**: 不能为空，且去除首尾空格后长度 > 0。校验失败提示："请输入酒品名称"。
3.  **评分 (必填)**: 必须 > 0。校验失败提示："请选择评分"。
4.  **价格 (可选)**: 若填写，必须为非负数。输入框限制只能输入数字和小数点。
5.  **字数限制**: 名称(50)、地点(100)、笔记(1000)、标签(20)。前端截断或禁止继续输入。

**异常处理**
1.  **图片过大**: 选择图片 > 2MB 时，自动压缩；若仍过大，提示"图片太大，请重新选择"。
2.  **存储满**: `wx.setStorage` 报错时，提示"存储空间不足，请清理微信缓存"。
3.  **ID冲突**: 极低概率。生成 ID 时若检测到已存在，自动重试生成。

## 4. 业务流程图

### 4.1 核心操作流程
```
[首页] -> 点击 "+" -> [新建页] -> 拍照/填表 -> 保存 -> [首页(刷新)]
[首页] -> 点击卡片 -> [编辑页] -> 修改信息 -> 保存 -> [首页(刷新)]
[编辑页] -> 点击删除 -> 确认 -> [首页(刷新)]
```

## 5. 异常处理

### 5.1 输入验证异常

**空白名称**
- 触发条件：保存时名称为空或仅包含空格
- 处理方式：显示提示"请输入酒品名称"，不执行保存

**价格格式错误**
- 触发条件：输入非数字字符
- 处理方式：输入框限制为数字键盘，自动过滤非法字符

**字数超限**
- 触发条件：输入超过字数限制
- 处理方式：输入框限制最大长度，超出部分无法输入

### 5.2 存储异常

**存储空间不足**
- 触发条件：本地存储空间已满
- 处理方式：
  - 显示提示："存储空间不足，请清理数据"
  - 保持当前编辑状态
  - 不执行保存操作

**存储写入失败**
- 触发条件：wx.setStorage 调用失败
- 处理方式：
  - 显示提示："保存失败，请重试"
  - 保留用户输入
  - 允许用户重新保存

**数据读取失败**
- 触发条件：wx.getStorage 调用失败
- 处理方式：
  - 尝试从备份恢复
  - 如果恢复失败，初始化为空数据
  - 显示提示："数据加载失败，请下拉刷新重试"

### 5.3 数据完整性异常

**记录缺少必填字段**
- 触发条件：从存储读取的记录缺少name字段
- 处理方式：自动补充默认值"未命名"

**记录ID冲突**
- 触发条件：生成的ID已存在
- 处理方式：重新生成ID直到唯一

**时间戳异常**
- 触发条件：时间戳为空或大于当前时间
- 处理方式：使用当前时间替换

**标签数据损坏**
- 触发条件：tags字段不是数组
- 处理方式：重置为空数组

### 5.4 图片处理异常

**图片选择失败**
- 触发条件：wx.chooseImage 调用失败
- 处理方式：
  - 显示提示："图片选择失败"
  - 允许用户重新选择

**图片过大**
- 触发条件：图片文件大于2MB
- 处理方式：
  - 自动压缩图片
  - 如果压缩后仍超过限制，提示用户选择其他图片

**图片格式不支持**
- 触发条件：选择的文件不是图片格式
- 处理方式：显示提示"仅支持JPG、PNG格式"

**图片加载失败**
- 触发条件：图片资源损坏或本地文件丢失
- 处理方式：
  - 显示默认的灰色占位图（酒杯图标）
  - 在编辑页允许用户重新上传图片

## 6. 附录

### 6.1 术语表
- 酒品记录：用户创建的单条酒类饮品记录
- 酒品库：用户所有酒品记录的集合
- 预设标签：系统提供的常用标签
- 自定义标签：用户自行创建的标签
- 本地存储：微信小程序的 wx.storage API
- 图标库: 类似 SF Symbols 的线性风格。
- 字体: 中文 PingFang SC，英文 San Francisco。

### 6.2 参考资料
- 微信小程序开发文档
- 微信小程序设计规范
- 用户研究报告
