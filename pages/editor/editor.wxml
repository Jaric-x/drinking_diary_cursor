<!--pages/editor/editor.wxml-->
<view class="editor-page">
  <!-- 自定义导航栏 -->
  <view class="editor-header" style="padding-top: {{statusBarHeight || 20}}px; height: {{totalNavHeight || 64}}px;">
    <view class="editor-header__blur"></view>
    <view class="editor-header__content" style="height: {{navBarHeight || 44}}px;">
      <!-- 左侧按钮 -->
      <view class="editor-header__left" bindtap="onCancel">
        <text class="editor-header__btn-text editor-header__btn-text--primary">{{isEditing ? '返回' : '取消'}}</text>
      </view>
      
      <!-- 中间标题 -->
      <view class="editor-header__center">
        <text class="editor-header__title">{{isEditing ? '编辑笔记' : '新建笔记'}}</text>
      </view>
      
      <!-- 右侧占位 -->
      <view class="editor-header__right"></view>
    </view>
  </view>

  <!-- 滚动内容区 -->
  <scroll-view class="editor-scroll" scroll-y show-scrollbar="{{false}}">
    <view class="editor-content">
      
      <!-- 照片上传区 -->
      <view class="photo-section">
        <view class="photo-upload {{imageUrl ? 'photo-upload--hasImage' : ''}}" bindtap="chooseImage">
          <image wx:if="{{imageUrl}}" class="photo-upload__image" src="{{imageUrl}}" mode="aspectFill" />
          <view wx:else class="photo-upload__placeholder">
            <text class="photo-upload__text">请拍摄/上传照片</text>
          </view>
          <!-- 修改按钮 - 仅在有图片时显示 -->
          <view wx:if="{{imageUrl}}" class="photo-upload__edit-btn">
            <text class="photo-upload__edit-icon">✎</text>
          </view>
        </view>
      </view>

      <!-- 核心信息组 -->
      <view class="form-group">
         <view class="form-item form-item--border">
           <view class="form-label">
             <text class="iconfont form-icon">{{icons.qianbi}}</text>
             <text class="form-label-text">名称</text>
           </view>
          <input 
            class="form-input" 
            type="text" 
            value="{{name}}"
            placeholder="请输入酒品名称"
            maxlength="50"
            bindinput="onNameInput"
          />
        </view>

         <view class="form-item">
           <view class="form-label">
             <text class="iconfont form-icon">{{icons.dianzan}}</text>
             <text class="form-label-text">评分</text>
           </view>
          <view class="rating-stars">
            <block wx:for="{{[1,2,3,4,5]}}" wx:key="*this">
              <text 
                class="rating-star {{rating >= item ? 'rating-star--filled' : ''}}"
                data-rating="{{item}}"
                bindtap="onRatingTap"
              >★</text>
            </block>
          </view>
        </view>
      </view>

      <!-- 详细信息组 -->
      <view class="form-group">
         <view class="form-item form-item--border">
           <view class="form-label">
             <text class="iconfont form-icon">{{icons.dingwei}}</text>
             <text class="form-label-text">地点</text>
           </view>
          <input 
            class="form-input" 
            type="text" 
            value="{{location}}"
            placeholder="在哪里喝的？"
            maxlength="100"
            bindinput="onLocationInput"
          />
        </view>

         <view class="form-item">
           <view class="form-label">
             <text class="iconfont form-icon">{{icons.kaquan}}</text>
             <text class="form-label-text">价格</text>
           </view>
          <view class="price-input-wrapper">
            <text class="price-prefix">¥</text>
            <input 
              class="form-input form-input--price" 
              type="digit" 
              value="{{price}}"
              placeholder="0.00"
              maxlength="8"
              bindinput="onPriceInput"
            />
          </view>
        </view>
      </view>

      <!-- 标签组 -->
       <view class="form-group form-group--tags">
         <view class="form-tags-header">
           <text class="iconfont form-icon">{{icons.kanjia}}</text>
           <text class="form-label-text">标签</text>
         </view>

        <view class="tags-container">
          <!-- 预设标签 -->
          <block wx:for="{{presetTags}}" wx:key="*this">
            <view 
              class="tag-chip {{tagSelectedMap[item] ? 'tag-chip--selected' : ''}}"
              data-tag="{{item}}"
              bindtap="toggleTag"
            >
              <text class="tag-chip__text">{{item}}</text>
            </view>
          </block>

          <!-- 自定义标签 -->
          <block wx:for="{{customTags}}" wx:key="*this">
            <view 
              class="tag-chip tag-chip--custom tag-chip--selected"
              data-tag="{{item}}"
              bindtap="toggleTag"
            >
              <text class="tag-chip__text">{{item}}</text>
              <text class="tag-chip__close">×</text>
            </view>
          </block>
        </view>

        <!-- 自定义标签输入 -->
        <view class="custom-tag-section">
          <view wx:if="{{!showCustomTagInput}}" class="custom-tag-trigger" bindtap="showCustomInput">
            <text class="custom-tag-trigger__text">+ 自定义标签</text>
          </view>
          
          <view wx:else class="custom-tag-input-box">
            <view class="custom-tag-chip">
              <input 
                class="custom-tag-chip__input" 
                type="text" 
                value="{{customTag}}"
                placeholder="最多5个字"
                maxlength="6"
                bindinput="onCustomTagInput"
                confirm-type="done"
                bindconfirm="addCustomTag"
                focus="{{showCustomTagInput}}"
              />
            </view>
            <text class="custom-tag-action" bindtap="addCustomTag">添加</text>
            <text class="custom-tag-action custom-tag-action--cancel" bindtap="cancelCustomInput">取消</text>
          </view>
        </view>
      </view>

      <!-- 描述组 -->
      <view class="form-group form-group--notes">
        <textarea 
          class="form-textarea"
          value="{{notes}}"
          placeholder="记录你的品鉴感受、配方、口感等..."
          maxlength="1000"
          auto-height
          bindinput="onNotesInput"
        />
      </view>

      <!-- 底部留白 -->
      <view class="editor-bottom-spacer"></view>
    </view>
  </scroll-view>

  <!-- 底部操作按钮 -->
  <view class="editor-footer">
    <view class="editor-footer__blur"></view>
    <view class="editor-footer__buttons">
      <!-- 删除按钮 - 仅编辑模式显示 -->
      <button 
        wx:if="{{isEditing}}"
        class="action-btn action-btn--delete" 
        bindtap="onDelete"
        hover-class="action-btn--hover"
        hover-start-time="0"
        hover-stay-time="100"
      >
        <text class="action-btn__text">删除</text>
      </button>
      
      <!-- 保存按钮 -->
      <button 
        class="action-btn action-btn--save {{isSubmitting ? 'action-btn--disabled' : ''}} {{isEditing ? '' : 'action-btn--full'}}" 
        bindtap="onSave"
        disabled="{{isSubmitting}}"
        hover-class="action-btn--hover"
        hover-start-time="0"
        hover-stay-time="100"
      >
        <text class="action-btn__text">{{isEditing ? '保存修改' : '保存笔记'}}</text>
      </button>
    </view>
  </view>
</view>
